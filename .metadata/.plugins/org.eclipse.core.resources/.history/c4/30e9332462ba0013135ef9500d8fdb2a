package ManagerFiles;

import com.sun.org.apache.xpath.internal.SourceTree;
import http.Interfaces.IHttpHandler;
import http.Interfaces.IRequestHttpHandler;
import http.Interfaces.IResponseHttpHandler;

import java.io.File;
import java.io.IOException;
import java.io.PrintWriter;
import java.net.URL;
import java.net.URLConnection;
import java.nio.file.Path;

/**
 * Created by server-pc on 31/03/14.
 */
public class HandlerFiles implements IHttpHandler{

    @Override
    public void execute(IRequestHttpHandler request, IResponseHttpHandler response) throws IOException {
    	String Path = new File("").getAbsolutePath() + File.separator + "www";
    	String html;
    	File file = new File(Path);
    	if(file.isFile()) {
    		
    	}
    	else if(file.isDirectory()) {
        	html += "<html><head><meta charset=\"utf-8\"></head><body><table><tr><th>Nom</th><th>Taille</th><th>Date de modification</th></tr>";
        	File file = new File(Path);
        	html += ListeFilesAndFolders(file,response,Path);
        	html += "</table></body></html>";
    	}
    	response.getWriter().write(html);
    	response.flush();
    }

    private String listFilesForFolder(String Path) {
        String html="<html><h2>Server Root-->"+Path+"</h2><body><ul>";
        File directory = new File(Path);
        File[] fList = directory.listFiles();
        for (File file : fList){
            html+="<li><h3><a href="+Path+"\\"+file.getName()+"/>"+file.getName()+"</h3></li>";
        }
        html+="</ul></body></html>";
        return html;
    }
    private String ListeFilesAndFolders(File file,IResponseHttpHandler response,String root) throws IOException {
        String html = "";
        File[] children = file.listFiles();
        if(children==null)
        {
            return;
        }
        for (File child : children)
        {
            ListeFilesAndFolders(child, response,root);
        }
    }
}